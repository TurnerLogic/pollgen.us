<html ng-app="pollCreateApp">
	<head>
		<title>Create your poll!</title>
		<link rel="stylesheet" href="../css/bootstrap.min.css">
		<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.16/angular.min.js"></script>
		<script src="../js/floatlabels.min.js"></script>

		<style>
			#question, .choice {
				height: 60px;
				border: 3px solid #78C0A8;
				border-radius: 30px;
			}

			#question {
				padding-left: 20px;
			}

			#poll-submit {
				color: #F0A830;
				background-color: white;
				border-radius: 30px;
				border: 3px solid #F0A830;
			}

			#add-choice-btn, #clear-choice-btn {
				height: 60px;
				width: 75px;
				background-color: #78C0A8;
				border: 3px solid #78C0A8;
			}

			#add-choice-btn {
				border-top-left-radius: 30px;
				border-bottom-left-radius: 30px;
			}

			#clear-choice-btn {
				border-top-right-radius: 30px;
				border-bottom-right-radius: 30px;
			}

			span.glyphicon {
				font-size: 3em;
				position: relative;
				top: -3;
				left: 4;
			}

			label.label-floatlabel {
				padding-left: 10px;
			}
		</style>
	</head>
	<body ng-controller="PollCreateCtrl">
		<div class="container">
			<div class="row">
				<h1>Poll Builder</h1>
				<input id="question" type="text" class="form-control floatlabel" placeholder="Add a question" ng-model="question" required>
			</div>
		      <table class="table table-striped" ng-show="choices.length > 0">
		        <thead>
		          <tr>
		            <th>Options</th>
		            <th>Choice</th>
		          </tr>
		        </thead>
		        <tbody>
		          <tr ng-repeat="choice in choices">
		            <td>
		              <button class="btn btn-danger btn-xs" ng-click="removeChoice($index)">Remove</button>
		            </td>
		            <td>{{ choice }}</td>
		          </tr>
		        </tbody>
		      </table>

		      <p ng-hide="choices.length > 0">Add choices to your poll to continue.</p>


		      <h2>Add Choice</h2>
		      <form role="form" ng-submit="addChoice()">
		        <div class="input-group">
		        	<span class="input-group-btn">
		        		<button id="add-choice-btn" class="btn btn-success"><span class="glyphicon glyphicon-plus"></span></button>
		        	</span>
		          <input type="text" class="form-control choice" id="text" placeholder="Add a response" ng-model="choiceNew" required>
		          <span class="input-group-btn">
		        	<button id="clear-choice-btn" type="button" class="btn btn-default" ng-click="choiceNew = ''">Clear</button>
		          </span>
		        </div>
		      </form>
		      <div class="row">
		      	<div class="col-lg-4 col-lg-offset-4">
		      		<button id="poll-submit" class="btn-block btn-lg" ng-click="submitPoll()">Submit Poll</button>
		      	</div>
		      </div>
      </div>
	</body>
	<script>
	(function() {
		$( 'input.floatlabel' ).floatlabel({
			slideInput: false,
			labelEndTop: '10px'
		});

		var app = angular.module('pollCreateApp', []);

		app.factory('pollService', function($http) {
			return {
				savePoll: function(data, cb) {
					$http.post('/polls/create', data).success(cb);
				}
			}
		});

		app.controller('PollCreateCtrl', function( $scope, pollService ) {

			$scope.choices = [];

			$scope.choiceNew = "";
			$scope.choiceEdit = "";

			$scope.question = "";

			$scope.poll = {};

			$scope.addQuestion = function()
			{
				console.log('question added');
			};

			$scope.removeChoice = function(index)
			{
				$scope.choices.splice(index, 1);
			};

			$scope.addChoice = function()
			{
				$scope.choices.push($scope.choiceNew);
				$scope.choiceNew = '';
				console.log($scope.choices);
			};

			$scope.submitPoll = function() {

				$scope.poll = {
					question: $scope.question,
					choices: $scope.choices
				};

				pollService.savePoll($scope.poll, function(code) {
						window.location = code;
				});
			};


		});
	}());
	</script>
</html>